define(["jquery","core/key_codes","core/pubsub","core/str","core_message/message_drawer_router","core_message/message_drawer_routes","core_message/message_drawer_events","core_message/message_drawer_view_overview_section","core_message/message_repository"],function(a,b,c,d,e,f,g,h,i){var j={CONTACT_REQUEST_COUNT:'[data-region="contact-request-count"]',FAVOURITES:'[data-region="view-overview-favourites"]',GROUP_MESSAGES:'[data-region="view-overview-group-messages"]',MESSAGES:'[data-region="view-overview-messages"]',SEARCH_INPUT:'[data-region="view-overview-search-input"]',SECTION_TOGGLE_BUTTON:"[data-toggle]"},k={PRIVATE:1,PUBLIC:2,FAVOURITE:null},l=null,m=function(a){return null===l&&(l=i.getAllConversationCounts(a)),l},n=function(a,b){return b===k.FAVOURITE?a.favourites:a.types[b]},o=function(a){var b=a.some(function(a){var b=a[0];return h.isVisible(b)});if(!b){a.sort(function(a,b){var c=a[1],d=a[2],e=b[1],f=b[2];return d>0&&0==f?-1:0==d&&f>0?1:c>0&&0==e?-1:0==c&&e>0?1:0});var c=a[0][0],d=c.find(j.SECTION_TOGGLE_BUTTON);d.click()}},p=function(a){return a.find(j.SEARCH_INPUT)},q=function(a){return a.attr("data-user-id")},r=function(a){return function(){var b=a.find(j.CONTACT_REQUEST_COUNT),c=parseInt(b.text(),10);c=isNaN(c)?0:c-1,c<=0?b.addClass("hidden"):b.text(c)}},s=function(a){var d=p(a),h=[b.tab,b.shift,b.ctrl,b.alt];d.on("click",function(){e.go(f.VIEW_SEARCH)}),d.on("keydown",function(a){h.indexOf(a.keyCode)<0&&"Meta"!=a.key&&e.go(f.VIEW_SEARCH)}),c.subscribe(g.CONTACT_REQUEST_ACCEPTED,r(a)),c.subscribe(g.CONTACT_REQUEST_DECLINED,r(a))},t=function(a,b){a.attr("data-init")||(s(a),a.attr("data-init",!0)),p(a).val("");var c=q(b),d=m(c),e=[[b.find(j.FAVOURITES),k.FAVOURITE,!0],[b.find(j.GROUP_MESSAGES),k.PUBLIC,!1],[b.find(j.MESSAGES),k.PRIVATE,!1]];return e.forEach(function(a){var b=a[0],c=a[1],e=a[2],f=d.then(function(a){return n(a.total,c)}),g=d.then(function(a){return n(a.unread,c)});h.show(b,c,e,f,g)}),d.then(function(a){var b=e.map(function(b){var c=b[0],d=b[1],e=n(a.total,d),f=n(a.unread,d);return[c,e,f]});return o(b)})},u=function(){return d.get_string("messagedrawerviewoverview","core_message")};return{show:t,description:u}});